
//------------------------------------------------------------------------------

//  <auto-generated>
//      This code was generated by:
//        TerminalGuiDesigner v1.1.0.0
//      You can make changes to this file and they will not be overwritten when saving.
//  </auto-generated>
// -----------------------------------------------------------------------------
namespace TerminalGuiDesigner.UI.Windows {
    using System.Reflection;
    using System.Text;
    using Terminal.Gui;
    
    
    public partial class SliderOptionEditor {
        private readonly Type genericTypeArgument;

        public bool Cancelled { get; internal set; } = true;
        public object Result { get; internal set; }

        /// <summary>
        /// Creates a new instance of the Designer to create an instance of <see cref="SliderOption{T}"/>
        /// where T is of <see cref="Type"/> <paramref name="genericTypeArgument"/>.
        /// </summary>
        /// <param name="genericTypeArgument">The T Type of the <see cref="SliderOption{T}"/> you want to design</param>
        public SliderOptionEditor(Type genericTypeArgument) {
            InitializeComponent();

            this.genericTypeArgument = genericTypeArgument;

            btnOk.Clicked += BtnOk_Clicked;
            btnCancel.Clicked += BtnCancel_Clicked;
        }

        private void BtnCancel_Clicked(object sender, EventArgs e)
        {
            this.Cancelled = true;
            Application.RequestStop();
        }

        private void BtnOk_Clicked(object sender, EventArgs e)
        {
            try
            {
                this.BuildResult();
            }
            catch(Exception ex)
            {
                ExceptionViewer.ShowException("Could not build result", ex);
                return;
            }

            this.Cancelled = false;
            Application.RequestStop();
        }

        private void BuildResult()
        {

            Type sliderOptionType = typeof(SliderOption<>).MakeGenericType(this.genericTypeArgument);
            Result = Activator.CreateInstance(sliderOptionType);

            var p = sliderOptionType.GetProperty("Legend");
            p.SetValue(Result, tfLegend.Text);

            p = sliderOptionType.GetProperty("LegendAbbr");
            p.SetValue(Result, new Rune(tfLegendAbbr.Text[0]));

            p = sliderOptionType.GetProperty("Data");

            if(this.genericTypeArgument == typeof(string))
            {
                p.SetValue(Result, tfData.Text);
            }
            else
            {
                p.SetValue(Result, Convert.ChangeType(tfData.Text, this.genericTypeArgument));
            }

        }
    }
}
